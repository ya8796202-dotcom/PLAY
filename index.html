<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PlayHub â€” Ù…Ù†ØµØ© Ø£Ù„Ø¹Ø§Ø¨ ÙŠØ§Ø³Ø±</title>
  <meta name="description" content="Ù…Ù†ØµØ© Ø£Ù„Ø¹Ø§Ø¨ Ø®ÙÙŠÙØ©ØŒ Ø£Ù†ÙŠÙ‚Ø©ØŒ ØªØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹" />
  <style>
    :root{
      --bg:#0b0f14; --card:#0f1720; --muted:#9aa0a6; --accent:#ff6fa9; --accent2:#7dd3fc;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter, "Segoe UI", system-ui, Arial; background:linear-gradient(180deg,#05060a 0%, #0b0f14 100%); color:#e6eef6}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;background:linear-gradient(90deg,var(--accent),var(--accent2));border-bottom-left-radius:18px;border-bottom-right-radius:18px;box-shadow:0 8px 30px rgba(0,0,0,0.45)}
    header h1{margin:0;font-size:1.2rem;color:#071022}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{background:rgba(255,255,255,0.12);border:none;padding:8px 12px;border-radius:10px;color:#fff;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:20px;max-width:1200px;margin:22px auto;padding:0 18px}
    aside{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
    main{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; min-height:520px}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;border:none;background:transparent;color:var(--muted);cursor:pointer;text-align:right}
    .menu button.active{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:#fff}
    .profile{margin-top:12px;padding:12px;border-radius:10px;background:var(--glass);display:flex;flex-direction:column;gap:8px}
    input[type="text"]{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:#fff}
    .scores{margin-top:14px;font-size:0.95rem;color:var(--muted)}
    .game-area{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:14px}
    .panel{width:100%;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    canvas{border-radius:10px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .cell{width:100%;height:100px;border-radius:8px;background:#0b0f14;display:flex;align-items:center;justify-content:center;font-size:2rem}
    .small{font-size:0.9rem;color:var(--muted)}
    footer{max-width:1200px;margin:18px auto;text-align:center;color:var(--muted);font-size:0.9rem}
    /* responsive */
    @media(max-width:880px){ .layout{grid-template-columns:1fr; padding:0 12px} aside{order:2} main{order:1} header{flex-direction:column;gap:10px;align-items:flex-start} }
  </style>
</head>
<body>
  <header>
    <h1 id="siteTitle">PlayHub â€” Ù…Ù†ØµØ© Ø£Ù„Ø¹Ø§Ø¨ ÙŠØ§Ø³Ø±</h1>
    <div class="controls">
      <button class="btn ghost" id="themeToggle">Ø«ÙŠÙ…</button>
      <button class="btn" id="soundToggle">ØµÙˆØª: ØªØ´ØºÙŠÙ„</button>
    </div>
  </header>

  <div class="layout">
    <aside>
      <div class="menu" id="gameMenu">
        <button data-game="tic" class="active">Ticâ€‘Tacâ€‘Toe</button>
        <button data-game="snake">Snake</button>
        <button data-game="g2048">2048</button>
        <button data-game="memory">Memory Cards</button>
      </div>

      <div class="profile panel">
        <label class="small">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</label>
        <input id="playerName" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="saveProfile">Ø­ÙØ¸</button>
          <button class="btn ghost" id="resetScores">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        </div>
      </div>

      <div class="panel scores" id="scorePanel">
        <div><strong>Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</strong></div>
        <ul id="bestList" style="padding-left:16px;margin:8px 0;color:var(--muted)"></ul>
      </div>
    </aside>

    <main>
      <div class="game-area">
        <div id="status" class="panel small">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù„Ø¹Ø¨Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨</div>

        <!-- Tic Tac Toe -->
        <div id="tic" class="panel" style="width:100%;max-width:520px;display:block">
          <h3>Ticâ€‘Tacâ€‘Toe</h3>
          <div id="ticBoard" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px"></div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn" id="ticReset">Ø¥Ø¹Ø§Ø¯Ø©</button>
            <button class="btn ghost" id="ticAI">Ø§Ù„Ù„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</button>
          </div>
        </div>

        <!-- Snake -->
        <div id="snake" class="panel" style="width:100%;max-width:520px;display:none">
          <h3>Snake</h3>
          <p class="small">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù‡Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</p>
          <canvas id="snakeCanvas" width="400" height="400"></canvas>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="snakeReset">Ø¥Ø¹Ø§Ø¯Ø©</button>
            <button class="btn ghost" id="snakeSpeed">ØªØ³Ø±ÙŠØ¹</button>
          </div>
        </div>

        <!-- 2048 -->
        <div id="g2048" class="panel" style="width:100%;max-width:520px;display:none">
          <h3>2048</h3>
          <p class="small">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù‡Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡</p>
          <canvas id="c2048" width="320" height="320"></canvas>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="g2048Reset">Ø¥Ø¹Ø§Ø¯Ø©</button>
          </div>
        </div>

        <!-- Memory -->
        <div id="memory" class="panel" style="width:100%;max-width:520px;display:none">
          <h3>Memory Cards</h3>
          <div id="memoryGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:12px"></div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="memoryReset">Ø¥Ø¹Ø§Ø¯Ø©</button>
          </div>
        </div>

      </div>
    </main>
  </div>

  <footer>Â© ÙŠØ§Ø³Ø± â€” Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ</footer>

<script>
/* ---------- Utilities ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const soundOn = { val: true };
function beep(freq=440, time=0.06, vol=0.05){
  if(!soundOn.val) return;
  try{
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator(), g = ctx.createGain();
    o.type='sine'; o.frequency.value = freq;
    g.gain.value = vol;
    o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + time);
    setTimeout(()=>{ o.stop(); ctx.close(); }, time*1000 + 50);
  }catch(e){}
}

/* ---------- App State ---------- */
const App = {
  player: localStorage.getItem('ph_player') || 'Ù„Ø§Ø¹Ø¨',
  best: JSON.parse(localStorage.getItem('ph_best') || '{}'),
  init(){
    $('#playerName').value = this.player;
    this.updateBestPanel();
    this.bindMenu();
    this.bindControls();
    this.initTic();
    this.initSnake();
    this.init2048();
    this.initMemory();
    $('#status').textContent = 'Ø¬Ø§Ù‡Ø² â€” Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø© ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨';
    // register sw if available
    if('serviceWorker' in navigator){
      navigator.serviceWorker?.register('sw.js').catch(()=>{/* ignore */});
    }
  },
  savePlayer(name){
    this.player = name || 'Ù„Ø§Ø¹Ø¨';
    localStorage.setItem('ph_player', this.player);
    $('#status').textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨: ' + this.player;
  },
  saveBest(key, value){
    if(!this.best[key] || value > this.best[key]) this.best[key] = value;
    localStorage.setItem('ph_best', JSON.stringify(this.best));
    this.updateBestPanel();
  },
  resetBest(){
    this.best = {}; localStorage.removeItem('ph_best'); this.updateBestPanel();
  },
  updateBestPanel(){
    const ul = $('#bestList'); ul.innerHTML = '';
    const keys = ['snake','g2048','tic','memory'];
    keys.forEach(k=>{
      const v = this.best[k] || 0;
      const li = document.createElement('li'); li.textContent = `${k} : ${v}`; ul.appendChild(li);
    });
  },
  bindMenu(){
    $$('#gameMenu button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#gameMenu button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        this.showGame(btn.dataset.game);
      });
    });
  },
  bindControls(){
    $('#saveProfile').addEventListener('click', ()=>{ this.savePlayer($('#playerName').value); });
    $('#resetScores').addEventListener('click', ()=>{ if(confirm('Ù…Ø³Ø­ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŸ')){ this.resetBest(); }});
    $('#themeToggle').addEventListener('click', ()=>{ document.body.classList.toggle('light'); });
    $('#soundToggle').addEventListener('click', ()=>{
      soundOn.val = !soundOn.val; $('#soundToggle').textContent = 'ØµÙˆØª: ' + (soundOn.val ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù');
    });
  },
  showGame(id){
    $$('.panel').forEach(p=>p.style.display='none');
    const el = document.getElementById(id);
    if(el) el.style.display = 'block';
    $('#status').textContent = 'Ø§Ù„Ù„Ø¹Ø¨Ø©: ' + (el ? el.querySelector('h3').textContent : id);
    beep(880,0.04,0.03);
  }
};

/* ---------- Tic Tac Toe ---------- */
App.initTic = function(){
  const boardEl = $('#ticBoard');
  let grid = Array(9).fill(null), ai = false, turn = 'X';
  function render(){
    boardEl.innerHTML = '';
    for(let i=0;i<9;i++){
      const b = document.createElement('div'); b.className='cell';
      b.textContent = grid[i] || '';
      b.style.cursor = grid[i] ? 'default' : 'pointer';
      b.addEventListener('click', ()=>{ if(grid[i]) return; grid[i]=turn; turn = turn==='X'?'O':'X'; render(); check(); if(ai) aiMove(); });
      boardEl.appendChild(b);
    }
  }
  function check(){
    const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const [a,b,c] of w){ if(grid[a] && grid[a]===grid[b] && grid[a]===grid[c]){ alert('ÙØ§Ø²: ' + grid[a]); App.saveBest('tic', (App.best.tic||0)+1); grid = Array(9).fill(null); render(); return; } }
    if(grid.every(Boolean)){ alert('ØªØ¹Ø§Ø¯Ù„'); grid = Array(9).fill(null); render(); }
  }
  function aiMove(){
    // Ø¨Ø³ÙŠØ·: ÙÙˆØ² Ø¥Ù† Ø£Ù…ÙƒÙ†ØŒ Ø¥ØºÙ„Ø§Ù‚ Ø¥Ù† Ø£Ù…ÙƒÙ†ØŒ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    const me = 'O', you='X';
    const winLine = (g, p)=>{ const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for(const l of lines){ const [a,b,c]=l; const vals=[g[a],g[b],g[c]]; if(vals.filter(v=>v===p).length===2 && vals.filter(v=>!v).length===1) return l[vals.indexOf(null)]; } return -1; };
    let idx = winLine(grid, me);
    if(idx===-1) idx = winLine(grid, you);
    if(idx===-1){
      const empt = grid.map((v,i)=>v?null:i).filter(v=>v!==null);
      idx = empt[Math.floor(Math.random()*empt.length)];
    }
    if(idx>=0){ grid[idx]=me; turn='X'; render(); check(); }
  }
  $('#ticReset').addEventListener('click', ()=>{ grid=Array(9).fill(null); render(); });
  $('#ticAI').addEventListener('click', ()=>{ ai = !ai; $('#ticAI').textContent = ai ? 'Ø§Ù„Ù„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (Ù…ÙØ¹Ù„)' : 'Ø§Ù„Ù„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±'; });
  render();
};

/* ---------- Snake ---------- */
App.initSnake = function(){
  const canvas = $('#snakeCanvas'); if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const size = 20, cols = canvas.width/size, rows = canvas.height/size;
  let snake = [{x:Math.floor(cols/2)*size, y:Math.floor(rows/2)*size}], dir={x:size,y:0}, food=null, speed=160, running=true;
  function placeFood(){ food = {x: Math.floor(Math.random()*cols)*size, y: Math.floor(Math.random()*rows)*size}; }
  function draw(){
    ctx.fillStyle = '#071018'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#ff6fa9'; snake.forEach(s=>ctx.fillRect(s.x+1,s.y+1,size-2,size-2));
    ctx.fillStyle = '#7dd3fc'; if(food) ctx.fillRect(food.x+2,food.y+2,size-4,size-4);
  }
  function step(){
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    // wrap-around
    if(head.x < 0) head.x = canvas.width - size;
    if(head.y < 0) head.y = canvas.height - size;
    if(head.x >= canvas.width) head.x = 0;
    if(head.y >= canvas.height) head.y = 0;
    if(snake.some((s,i)=>i>0 && s.x===head.x && s.y===head.y)){ alert('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©'); App.saveBest('snake', Math.max(App.best.snake||0, snake.length)); snake=[{x:Math.floor(cols/2)*size,y:Math.floor(rows/2)*size}]; dir={x:size,y:0}; placeFood(); return; }
    snake.unshift(head);
    if(food && head.x===food.x && head.y===food.y){ placeFood(); beep(660,0.06,0.04); }
    else snake.pop();
    draw();
  }
  let timer = setInterval(step, speed);
  $('#snakeReset').addEventListener('click', ()=>{ snake=[{x:Math.floor(cols/2)*size,y:Math.floor(rows/2)*size}]; dir={x:size,y:0}; placeFood(); });
  $('#snakeSpeed').addEventListener('click', ()=>{ clearInterval(timer); speed = Math.max(60, speed - 30); timer = setInterval(step, speed); $('#status').textContent = 'Ø³Ø±Ø¹Ø©: ' + speed + 'ms'; });
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp' && dir.y===0) dir={x:0,y:-size};
    if(e.key==='ArrowDown' && dir.y===0) dir={x:0,y:size};
    if(e.key==='ArrowLeft' && dir.x===0) dir={x:-size,y:0};
    if(e.key==='ArrowRight' && dir.x===0) dir={x:size,y:0};
  });
  // touch swipe
  let touchStart = null;
  canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; touchStart = {x:t.clientX, y:t.clientY}; });
  canvas.addEventListener('touchend', e=>{
    if(!touchStart) return;
    const t = e.changedTouches[0]; const dx = t.clientX - touchStart.x, dy = t.clientY - touchStart.y;
    if(Math.abs(dx) > Math.abs(dy)){
      if(dx>20 && dir.x===0) dir={x:size,y:0};
      if(dx<-20 && dir.x===0) dir={x:-size,y:0};
    } else {
      if(dy>20 && dir.y===0) dir={x:0,y:size};
      if(dy<-20 && dir.y===0) dir={x:0,y:-size};
    }
    touchStart = null;
  });
  placeFood(); draw();
};

/* ---------- 2048 ---------- */
App.init2048 = function(){
  const cv = $('#c2048'); if(!cv) return;
  const ctx = cv.getContext('2d'); let grid = Array(16).fill(0);
  function addTile(){ const empt = grid.map((v,i)=>v?null:i).filter(v=>v!==null); if(!empt.length) return; grid[empt[Math.floor(Math.random()*empt.length)]] = Math.random()<0.9?2:4; }
  function draw(){
    ctx.fillStyle = '#071018'; ctx.fillRect(0,0,cv.width,cv.height);
    for(let r=0;r<4;r++) for(let c=0;c<4;c++){
      const v = grid[r*4+c];
      ctx.fillStyle = v ? `hsl(${Math.min(280,Math.log2(v)*25)},70%,55%)` : '#0b0f14';
      ctx.fillRect(c*80+6, r*80+6, 68, 68);
      if(v){ ctx.fillStyle='#071022'; ctx.font='bold 20px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(v, c*80+40, r*80+40); }
    }
  }
  function rotate(m){ const o=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]; for(let r=0;r<4;r++) for(let c=0;c<4;c++) o[c][3-r]=m[r][c]; return o; }
  function move(dir){
    let moved=false; let m=[]; for(let r=0;r<4;r++) m.push(grid.slice(r*4,r*4+4));
    if(dir==='up') m = rotate(rotate(rotate(m)));
    if(dir==='right') m = m.map(row=>row.reverse());
    if(dir==='down') m = rotate(m);
    m = m.map(row=>{
      row = row.filter(v=>v);
      for(let i=0;i<row.length-1;i++){ if(row[i]===row[i+1]){ row[i]*=2; row[i+1]=0; moved=true; } }
      row = row.filter(v=>v); while(row.length<4) row.push(0); return row;
    });
    if(dir==='up') m = rotate(rotate(rotate(m)));
    else if(dir==='right') m = m.map(row=>row.reverse());
    else if(dir==='down') m = rotate(m);
    const ng = [].concat(...m);
    if(ng.some((v,i)=>v!==grid[i])) moved = true;
    if(moved){ grid = ng; addTile(); draw(); const bestTile = Math.max(...grid); App.saveBest('g2048', bestTile); }
  }
  function isOver(){
    if(grid.some(v=>v===0)) return false;
    const copy = [...grid];
    for(const d of ['up','down','left','right']){ grid = [...copy]; move(d); if(grid.some((v,i)=>v!==copy[i])){ grid = copy; return false; } }
    grid = copy; return true;
  }
  $('#g2048Reset').addEventListener('click', ()=>{ grid = Array(16).fill(0); addTile(); addTile(); draw(); });
  addTile(); addTile(); draw();
  window.addEventListener('keydown', e=>{
    const map = {ArrowUp:'up',ArrowDown:'down',ArrowLeft:'left',ArrowRight:'right'};
    if(map[e.key]){ move(map[e.key]); if(isOver()){ alert('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©'); grid = Array(16).fill(0); addTile(); addTile(); draw(); } }
  });
};

/* ---------- Memory Cards ---------- */
App.initMemory = function(){
  const gridEl = $('#memoryGrid'); if(!gridEl) return;
  const symbols = ['ğŸ','ğŸ‹','ğŸ‡','ğŸ“','ğŸ‰','ğŸ¥','ğŸ','ğŸ’'];
  let cards = [], openIdx=null, lock=false, matched=0;
  function reset(){
    cards = symbols.concat(symbols).sort(()=>Math.random()-0.5).map(s=>({s,open:false,matched:false}));
    openIdx=null; lock=false; matched=0; render();
  }
  function render(){
    gridEl.innerHTML = '';
    cards.forEach((c,i)=>{
      const d = document.createElement('div'); d.className='cell'; d.style.height='80px';
      d.textContent = c.open || c.matched ? c.s : 'â“';
      d.style.cursor = c.open || c.matched ? 'default' : 'pointer';
      d.addEventListener('click', ()=>{
        if(lock || c.open || c.matched) return;
        c.open = true; render();
        if(openIdx===null) openIdx = i;
        else {
          lock = true;
          setTimeout(()=>{
            if(cards[openIdx].s === c.s){ cards[openIdx].matched = c.matched = true; matched += 2; beep(880,0.05,0.04); }
            else { cards[openIdx].open = c.open = false; }
            openIdx = null; lock = false; render();
            if(matched === cards.length){ alert('ÙÙˆØ²!'); App.saveBest('memory', (App.best.memory||0)+1); reset(); }
          }, 500);
        }
      });
      gridEl.appendChild(d);
    });
  }
  $('#memoryReset').addEventListener('click', reset);
  reset();
};

/* ---------- Start App ---------- */
document.addEventListener('DOMContentLoaded', ()=>{ App.init(); App.showGame('tic'); });
</script>
</body>
</html>
